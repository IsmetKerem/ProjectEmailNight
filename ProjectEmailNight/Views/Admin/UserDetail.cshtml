@model ProjectEmailNight.Models.AdminUserDetailViewModel
@{
    ViewData["Title"] = Model.FullName;
    ViewData["PageTitle"] = "Kullanıcı Detayı";
}

<div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
    <a asp-action="Users" class="btn btn--secondary btn--sm">
        <i class="fa-solid fa-arrow-left"></i>
        <span>Geri</span>
    </a>
</div>

@if(TempData["Success"] != null)
{
    <div class="alert alert--success" style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; border-radius: 0.5rem; color: #10b981;">
        <i class="fa-solid fa-check-circle"></i> @TempData["Success"]
    </div>
}

@if(TempData["Error"] != null)
{
    <div class="alert alert--error" style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 0.5rem; color: #ef4444;">
        <i class="fa-solid fa-exclamation-circle"></i> @TempData["Error"]
    </div>
}

<div class="profile">
    <!-- Sol: Kullanıcı Bilgileri -->
    <article class="card">
        <header class="profile__header">
            <div class="profile__avatar">
                <div class="profile__avatar-inner">@Model.Initials</div>
            </div>
            <div>
                <h2 class="profile__name">@Model.FullName</h2>
                <p class="u-text-muted">@Model.Email</p>
                <div style="margin-top: 0.5rem;">
                    @foreach(var role in Model.Roles)
                    {
                        var badgeClass = role == "Admin" ? "u-badge--danger" : "u-badge--info";
                        <span class="u-badge @badgeClass">@role</span>
                    }
                </div>
            </div>
        </header>

        <div class="profile__stats" style="margin-top: 1.5rem;">
            <div class="profile__stat">
                <div class="profile__stat-value">@Model.SentEmailsCount</div>
                <div>Gönderilen</div>
            </div>
            <div class="profile__stat">
                <div class="profile__stat-value">@Model.ReceivedEmailsCount</div>
                <div>Alınan</div>
            </div>
            <div class="profile__stat">
                <div class="profile__stat-value">@Model.DraftsCount</div>
                <div>Taslak</div>
            </div>
        </div>

        <div style="margin-top: 1.5rem;">
            <p class="u-text-muted" style="font-size: 0.8rem;">
                <i class="fa-solid fa-calendar"></i> Kayıt: @Model.CreatedAt.ToString("dd MMM yyyy HH:mm")
            </p>
            @if(Model.LastLoginAt.HasValue)
            {
                <p class="u-text-muted" style="font-size: 0.8rem; margin-top: 0.25rem;">
                    <i class="fa-solid fa-clock"></i> Son Giriş: @Model.LastLoginAt.Value.ToString("dd MMM yyyy HH:mm")
                </p>
            }
        </div>
    </article>

    <!-- Sağ: İşlemler -->
    <aside class="card card--soft">
        <section class="profile__settings-group">
            <h3 class="profile__settings-title">Rol Yönetimi</h3>
            
            <div class="profile__settings-row">
                <span>Admin Rolü</span>
                <form asp-action="ToggleRole" method="post" style="display: inline;">
                    <input type="hidden" name="userId" value="@Model.Id" />
                    <input type="hidden" name="role" value="Admin" />
                    <button type="submit" class="btn @(Model.Roles.Contains("Admin") ? "btn--danger" : "btn--primary") btn--sm">
                        @if(Model.Roles.Contains("Admin"))
                        {
                            <i class="fa-solid fa-minus"></i>
                            <span>Kaldır</span>
                        }
                        else
                        {
                            <i class="fa-solid fa-plus"></i>
                            <span>Ekle</span>
                        }
                    </button>
                </form>
            </div>

            <div class="profile__settings-row">
                <span>User Rolü</span>
                <form asp-action="ToggleRole" method="post" style="display: inline;">
                    <input type="hidden" name="userId" value="@Model.Id" />
                    <input type="hidden" name="role" value="User" />
                    <button type="submit" class="btn @(Model.Roles.Contains("User") ? "btn--danger" : "btn--primary") btn--sm">
                        @if(Model.Roles.Contains("User"))
                        {
                            <i class="fa-solid fa-minus"></i>
                            <span>Kaldır</span>
                        }
                        else
                        {
                            <i class="fa-solid fa-plus"></i>
                            <span>Ekle</span>
                        }
                    </button>
                </form>
            </div>
        </section>

        <section class="profile__settings-group" style="margin-top: 1.5rem;">
            <h3 class="profile__settings-title">Tehlikeli Bölge</h3>
            <form asp-action="DeleteUser" method="post" onsubmit="return confirm('Bu kullanıcıyı silmek istediğinize emin misiniz? Bu işlem geri alınamaz!')">
                <input type="hidden" name="userId" value="@Model.Id" />
                <button type="submit" class="btn btn--danger btn--sm" style="width: 100%;">
                    <i class="fa-solid fa-trash"></i>
                    <span>Kullanıcıyı Sil</span>
                </button>
            </form>
        </section>
    </aside>
</div>

<!-- Son E-postalar -->
<div class="card" style="margin-top: 1rem;">
    <header class="card__header">
        <p class="card__title">Son E-postalar</p>
    </header>
    <div class="admin-table-wrapper" style="margin-top: 0.75rem;">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Yön</th>
                    <th>Kişi</th>
                    <th>Konu</th>
                    <th>Tarih</th>
                </tr>
            </thead>
            <tbody>
                @foreach(var email in Model.RecentEmails)
                {
                    var isSent = email.SenderId == Model.Id;
                    <tr>
                        <td>
                            @if(isSent)
                            {
                                <span class="u-badge u-badge--info">Gönderdi</span>
                            }
                            else
                            {
                                <span class="u-badge u-badge--success">Aldı</span>
                            }
                        </td>
                        <td>
                            @if(isSent)
                            {
                                @email.Receiver?.Name @email.Receiver?.Surname
                            }
                            else
                            {
                                @email.Sender?.Name @email.Sender?.Surname
                            }
                        </td>
                        <td>@email.Subject</td>
                        <td class="u-text-muted">@email.CreatedAt.ToString("dd MMM HH:mm")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Styles {
<style>
    .btn--danger {
        background: #ef4444;
        color: #fff;
        border: none;
    }
    .btn--danger:hover {
        background: #dc2626;
    }
    
    .admin-table-wrapper { overflow-x: auto; }
    .admin-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
    .admin-table th, .admin-table td { padding: 0.6rem 0.75rem; text-align: left; border-bottom: 1px solid #1f2937; }
    .admin-table th { color: #6b7280; font-weight: 500; font-size: 0.75rem; text-transform: uppercase; }
    .admin-table tr:hover { background: rgba(124, 58, 237, 0.05); }
</style>
}